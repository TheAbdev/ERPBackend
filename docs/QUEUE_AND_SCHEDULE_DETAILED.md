# ุฏููู ุชูุตููู: Queue Workers ู Scheduled Tasks

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุนูุฏูุง ุชุดุบู `php artisan queue:work` ู `php artisan schedule:work`ุ ูุชู ุชูููุฐ ุงูููุงู ุงูุชุงููุฉ:

---

## ๐ `schedule:work` - ุงูููุงู ุงููุฌุฏููุฉ (Scheduled Tasks)

ุงูููุงู ุงููุฌุฏููุฉ ููุฌูุฏุฉ ูู: `routes/console.php`

### 1. **`crm:check-activity-reminders`** 
- **ุงูุชูุฑุงุฑ:** ูู 5 ุฏูุงุฆู
- **ุงูููู:** `app/Console/Commands/CheckActivityReminders.php`
- **ุงููุธููุฉ:** 
  - ูุจุญุซ ุนู ุงูุฃูุดุทุฉ (Activities) ุงูุชู ุณุชููู ูุณุชุญูุฉ ุฎูุงู 15 ุฏูููุฉ
  - ูุฑุณู ุชุฐููุฑุงุช ูููุณุชุฎุฏููู ุงููุนูููู
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `activities` - ููุจุญุซ ุนู ุงูุฃูุดุทุฉ ุงููุณุชุญูุฉ
  - `notifications` - ูุญูุธ ุงูุฅุดุนุงุฑุงุช
- **ูุถูู ุฅูู ุงูุทุงุจูุฑ:**
  - `SendActivityReminderJob` - ูุฅุฑุณุงู ุงูุชุฐููุฑุงุช

---

### 2. **`crm:sync-email-accounts`**
- **ุงูุชูุฑุงุฑ:** ูู 5 ุฏูุงุฆู
- **ุงูููู:** `app/Console/Commands/SyncEmailAccounts.php`
- **ุงููุธููุฉ:**
  - ูุฒุงููุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูู ุญุณุงุจุงุช IMAP
  - ุฌูุจ ุงูุฑุณุงุฆู ุงูุฌุฏูุฏุฉ ูู ุฌููุน ุงูุญุณุงุจุงุช ุงููุดุทุฉ
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `email_accounts` - ุญุณุงุจุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
  - `emails` - ุงูุฑุณุงุฆู ุงููุณุชูุฑุฏุฉ

---

### 3. **`erp:generate-scheduled-reports`**
- **ุงูุชูุฑุงุฑ:** ูู ุฏูููุฉ
- **ุงูููู:** `app/Console/Commands/GenerateScheduledReports.php`
- **ุงููุธููุฉ:**
  - ูุชุญูู ูู ุงูุชูุงุฑูุฑ ุงููุฌุฏููุฉ (`erp_report_schedules`)
  - ูููุฏ ุงูุชูุงุฑูุฑ ุงูุชู ุญุงู ููุชูุง
  - ูุตุฏุฑ ุงูุชูุงุฑูุฑ ุจุตูุบ ูุฎุชููุฉ (PDF, Excel, CSV)
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `erp_report_schedules` - ุฌุฏูู ุงูุชูุงุฑูุฑ ุงููุฌุฏููุฉ
  - `erp_reports` - ุงูุชูุงุฑูุฑ ููุณูุง
- **ูุถูู ุฅูู ุงูุทุงุจูุฑ:**
  - `ExportReportJob` - ูุชุตุฏูุฑ ูุฅุฑุณุงู ุงูุชูุงุฑูุฑ

---

### 4. **`erp:check-system-health`**
- **ุงูุชูุฑุงุฑ:** ูู 5 ุฏูุงุฆู
- **ุงูููู:** `app/Console/Commands/CheckSystemHealth.php`
- **ุงููุธููุฉ:**
  - ูุญุต ุตุญุฉ ุงููุธุงู ูุฌููุน ุงููุณุชุฃุฌุฑูู (Tenants)
  - ูุฑุงูุจุฉ ุงุณุชุฎุฏุงู CPUุ ุงูุฐุงูุฑุฉุ ุงููุฑุต
  - ูุญุต ุงูุงุชุตุงูุงุช ุงููุดุทุฉ ูุญุฌู ุงูุทุงุจูุฑ
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `system_health` - ูุญูุธ ูุชุงุฆุฌ ุงููุญุต
  - `tenants` - ูุงุฆูุฉ ุงููุณุชุฃุฌุฑูู

---

### 5. **`erp-retry-webhook-deliveries`**
- **ุงูุชูุฑุงุฑ:** ูู 10 ุฏูุงุฆู
- **ุงูููู:** `routes/console.php` (ูููุฉ ูุจุงุดุฑุฉ)
- **ุงููุธููุฉ:**
  - ุฅุนุงุฏุฉ ูุญุงููุฉ ุฅุฑุณุงู Webhooks ุงููุงุดูุฉ
  - ุงูุจุญุซ ุนู ุนูููุงุช ุงูุชุณููู (`webhook_deliveries`) ุงููุงุดูุฉ ูุฅุนุงุฏุฉ ูุญุงููุชูุง
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `erp_webhook_deliveries` - ุนูููุงุช ุชุณููู Webhooks
  - `erp_webhooks` - ุฅุนุฏุงุฏุงุช Webhooks

---

### 6. **`erp:generate-recurring-invoices`**
- **ุงูุชูุฑุงุฑ:** ููููุงู (Daily)
- **ุงูููู:** `app/Console/Commands/GenerateRecurringInvoices.php`
- **ุงููุธููุฉ:**
  - ุชูููุฏ ุงูููุงุชูุฑ ุงููุชูุฑุฑุฉ ุงููุณุชุญูุฉ
  - ุฅูุดุงุก ููุงุชูุฑ ุฌุฏูุฏุฉ ุจูุงุกู ุนูู ุงูุฌุฏุงูู ุงููุชูุฑุฑุฉ
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `erp_recurring_invoices` - ุงูููุงุชูุฑ ุงููุชูุฑุฑุฉ
  - `erp_invoices` - ุงูููุงุชูุฑ ุงููููุดุฃุฉ

---

### 7. **`erp:check-reorder-rules`**
- **ุงูุชูุฑุงุฑ:** ููููุงู (Daily)
- **ุงูููู:** `app/Console/Commands/CheckReorderRules.php`
- **ุงููุธููุฉ:**
  - ูุญุต ููุงุนุฏ ุฅุนุงุฏุฉ ุงูุทูุจ (Reorder Rules)
  - ุฅูุดุงุก ุฃูุงูุฑ ุดุฑุงุก ุชููุงุฆูุฉ ููููุชุฌุงุช ุงูุชู ุชุญุชุงุฌ ุฅุนุงุฏุฉ ุทูุจ
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `erp_products` - ุงูููุชุฌุงุช
  - `erp_reorder_rules` - ููุงุนุฏ ุฅุนุงุฏุฉ ุงูุทูุจ
  - `erp_purchase_orders` - ุฃูุงูุฑ ุงูุดุฑุงุก ุงููููุดุฃุฉ

---

## ๐ฆ `queue:work` - ุงูููุงู ูู ุงูุทุงุจูุฑ (Queue Jobs)

ุงูููุงู ูู ุงูุทุงุจูุฑ ููุฌูุฏุฉ ูู: `app/Jobs/`

### 1. **`DeliverWebhookJob`**
- **ุงูููู:** `app/Jobs/DeliverWebhookJob.php`
- **ุงููุธููุฉ:**
  - ุฅุฑุณุงู Webhooks ุฅูู URLs ุฎุงุฑุฌูุฉ
  - ุฅุฑุณุงู ุจูุงูุงุช ุงูุฃุญุฏุงุซ (Events) ุฅูู ุฃูุธูุฉ ุฎุงุฑุฌูุฉ
- **ูุชู ููุถุงู ููุทุงุจูุฑ:**
  - ุนูุฏ ุญุฏูุซ ุญุฏุซ ูู ุงููุธุงู (ูุซู: ุฅูุดุงุก ุตููุฉุ ุชุญุฏูุซ ููุชุฌุ ุฅูุฎ)
  - ูุชู ุฅุถุงูุชู ูู `WebhookService::queueDelivery()`
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `erp_webhook_deliveries` - ูุชุณุฌูู ูุญุงููุงุช ุงูุชุณููู
  - `erp_webhooks` - ุฅุนุฏุงุฏุงุช Webhooks

---

### 2. **`ExecuteWorkflowJob`**
- **ุงูููู:** `app/Jobs/ExecuteWorkflowJob.php`
- **ุงููุธููุฉ:**
  - ุชูููุฐ Workflows ุชููุงุฆูุงู
  - ุชุดุบูู ุงูุฅุฌุฑุงุกุงุช ุงููุญุฏุฏุฉ ุนูุฏ ุญุฏูุซ ุฃุญุฏุงุซ ูุนููุฉ
- **ูุชู ููุถุงู ููุทุงุจูุฑ:**
  - ุนูุฏ ุญุฏูุซ ุญุฏุซ ูุทุงุจู Workflow (ูุซู: ุฅูุดุงุก Leadุ ุชุบููุฑ ุญุงูุฉ Deal)
  - ูุชู ุฅุถุงูุชู ูู `WorkflowEngineService::trigger()`
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `workflows` - ุชุนุฑููุงุช Workflows
  - `workflow_runs` - ุณุฌู ุชูููุฐ Workflows
  - `workflow_instances` - ุญุงูุงุช Workflows

---

### 3. **`ExportReportJob`**
- **ุงูููู:** `app/Jobs/ExportReportJob.php`
- **ุงููุธููุฉ:**
  - ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ ุจุตูุบ ูุฎุชููุฉ (PDF, Excel, CSV)
  - ุฅุฑุณุงู ุงูุชูุงุฑูุฑ ุฅูู ุงููุณุชูููู ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- **ูุชู ููุถุงู ููุทุงุจูุฑ:**
  - ูู `GenerateScheduledReports` command ุนูุฏ ุญุงู ููุช ุชูุฑูุฑ ูุฌุฏูู
  - ุนูุฏ ุทูุจ ุชุตุฏูุฑ ุชูุฑูุฑ ูุฏููุงู
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `erp_report_schedules` - ุฌุฏูู ุงูุชูุงุฑูุฑ ุงููุฌุฏููุฉ
  - `erp_reports` - ุงูุชูุงุฑูุฑ

---

### 4. **`SendActivityReminderJob`**
- **ุงูููู:** `app/Jobs/SendActivityReminderJob.php`
- **ุงููุธููุฉ:**
  - ุฅุฑุณุงู ุชุฐููุฑุงุช ูููุณุชุฎุฏููู ุญูู ุงูุฃูุดุทุฉ ุงููุณุชุญูุฉ
  - ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูููุณุชุฎุฏู ุงููุนูู ุฃู ุงูููุดุฆ
- **ูุชู ููุถุงู ููุทุงุจูุฑ:**
  - ูู `CheckActivityReminders` command ูู 5 ุฏูุงุฆู
  - ุนูุฏ ุฅูุดุงุก ูุดุงุท ุฌุฏูุฏ
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `activities` - ุงูุฃูุดุทุฉ
  - `notifications` - ุงูุฅุดุนุงุฑุงุช

---

### 5. **`SendDealNotificationJob`**
- **ุงูููู:** `app/Jobs/SendDealNotificationJob.php`
- **ุงููุธููุฉ:**
  - ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูุตููุฉ
  - ุฅุดุนุงุฑ ุงููุณุชุฎุฏู ุงููุนูู ูุงูููุดุฆ
- **ูุชู ููุถุงู ููุทุงุจูุฑ:**
  - ุนูุฏ ุชุบููุฑ ุญุงูุฉ Deal (ูู Event Listener)
  - ูู `DealStatusChanged` event
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `deals` - ุงูุตููุงุช
  - `notifications` - ุงูุฅุดุนุงุฑุงุช

---

### 6. **`ImportDataJob`**
- **ุงูููู:** `app/Jobs/ImportDataJob.php`
- **ุงููุธููุฉ:**
  - ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ูู ูููุงุช CSV/Excel
  - ุงุณุชูุฑุงุฏ Leadsุ Contactsุ ุฃู Deals
- **ูุชู ููุถุงู ููุทุงุจูุฑ:**
  - ุนูุฏ ุฑูุน ููู ุงุณุชูุฑุงุฏ ูู ุงููุณุชุฎุฏู
  - ูู ูุงุฌูุฉ ุงูุงุณุชูุฑุงุฏ
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `import_results` - ูุชุงุฆุฌ ุงูุงุณุชูุฑุงุฏ
  - `leads` / `contacts` / `deals` - ุงูุจูุงูุงุช ุงููุณุชูุฑุฏุฉ

---

### 7. **`SendEmailCampaignJob`**
- **ุงูููู:** `app/Jobs/SendEmailCampaignJob.php`
- **ุงููุธููุฉ:**
  - ุฅุฑุณุงู ุญููุงุช ุจุฑูุฏ ุฅููุชุฑููู ุฌูุงุนูุฉ
  - ุฅุฑุณุงู ุฑุณุงุฆู ุฅูู ูุงุฆูุฉ ูู ุงููุณุชูููู
- **ูุชู ููุถุงู ููุทุงุจูุฑ:**
  - ุนูุฏ ุฅุฑุณุงู ุญููุฉ ุจุฑูุฏ ุฅููุชุฑููู ูู `EmailCampaignController`
  - ุนูุฏ ุฌุฏููุฉ ุญููุฉ ุจุฑูุฏ ุฅููุชุฑููู
- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:**
  - `email_campaigns` - ุงูุญููุงุช ุงูุจุฑูุฏูุฉ
  - `email_accounts` - ุญุณุงุจุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

---

## ๐๏ธ ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ

### ุฌุฏุงูู ุงูุทุงุจูุฑ (Queue Tables):
- **`jobs`** - ุงูููุงู ูู ุงูุทุงุจูุฑ (Laravel Queue)
- **`job_batches`** - ูุฌููุนุงุช ุงูููุงู
- **`failed_jobs`** - ุงูููุงู ุงููุงุดูุฉ

### ุฌุฏุงูู ุงูููุงู ุงููุฌุฏููุฉ:
- **`erp_report_schedules`** - ุงูุชูุงุฑูุฑ ุงููุฌุฏููุฉ
  - ูุญุชูู ุนูู: `cron_expression`, `next_run_at`, `last_run_at`, `is_active`
- **`system_health`** - ุตุญุฉ ุงููุธุงู
- **`erp_recurring_invoices`** - ุงูููุงุชูุฑ ุงููุชูุฑุฑุฉ
- **`erp_reorder_rules`** - ููุงุนุฏ ุฅุนุงุฏุฉ ุงูุทูุจ

### ุฌุฏุงูู ุงูููุงู ูู ุงูุทุงุจูุฑ:
- **`erp_webhook_deliveries`** - ุนูููุงุช ุชุณููู Webhooks
  - ูุญุชูู ุนูู: `status`, `attempts`, `response_code`, `delivered_at`
- **`import_results`** - ูุชุงุฆุฌ ุงูุงุณุชูุฑุงุฏ
  - ูุญุชูู ุนูู: `status`, `success_count`, `failed_count`, `error_log`
- **`workflows`** - ุชุนุฑููุงุช Workflows
- **`workflow_runs`** - ุณุฌู ุชูููุฐ Workflows
- **`activities`** - ุงูุฃูุดุทุฉ
- **`deals`** - ุงูุตููุงุช
- **`email_campaigns`** - ุงูุญููุงุช ุงูุจุฑูุฏูุฉ
- **`notifications`** - ุงูุฅุดุนุงุฑุงุช

---

## ๐ ููุฎุต ุณุฑูุน

### `schedule:work` ูุดุบู:
1. โ ูุญุต ุชุฐููุฑุงุช ุงูุฃูุดุทุฉ (ูู 5 ุฏูุงุฆู)
2. โ ูุฒุงููุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ูู 5 ุฏูุงุฆู)
3. โ ุชูููุฏ ุงูุชูุงุฑูุฑ ุงููุฌุฏููุฉ (ูู ุฏูููุฉ)
4. โ ูุญุต ุตุญุฉ ุงููุธุงู (ูู 5 ุฏูุงุฆู)
5. โ ุฅุนุงุฏุฉ ูุญุงููุฉ Webhooks ุงููุงุดูุฉ (ูู 10 ุฏูุงุฆู)
6. โ ุชูููุฏ ุงูููุงุชูุฑ ุงููุชูุฑุฑุฉ (ููููุงู)
7. โ ูุญุต ููุงุนุฏ ุฅุนุงุฏุฉ ุงูุทูุจ (ููููุงู)

### `queue:work` ูุนุงูุฌ:
1. โ ุฅุฑุณุงู Webhooks
2. โ ุชูููุฐ Workflows
3. โ ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ
4. โ ุฅุฑุณุงู ุชุฐููุฑุงุช ุงูุฃูุดุทุฉ
5. โ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุงูุตููุงุช
6. โ ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช
7. โ ุฅุฑุณุงู ุงูุญููุงุช ุงูุจุฑูุฏูุฉ

---

## ๐ ููููุฉ ุงูุชุญูู ูู ุนูู ุงูููุงู

### ุงูุชุญูู ูู ุงูููุงู ุงููุฌุฏููุฉ:
```bash
php artisan schedule:list
```

### ุงูุชุญูู ูู ุงูููุงู ูู ุงูุทุงุจูุฑ:
```bash
# ุนุฑุถ ุงูููุงู ุงููุนููุฉ
php artisan queue:work --once

# ุนุฑุถ ุงูููุงู ุงููุงุดูุฉ
php artisan queue:failed
```

### ุนุฑุถ ุณุฌูุงุช ุงูููุงู:
```bash
tail -f storage/logs/laravel.log | grep "Running scheduled command"
tail -f storage/logs/laravel.log | grep "Job"
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **`schedule:work`** ูุฌุจ ุฃู ูุนูู ุฏุงุฆูุงู ูู Production
2. **`queue:work`** ูุฌุจ ุฃู ูุนูู ุฏุงุฆูุงู ุฅุฐุง ูุงู ูุฏูู ููุงู ูู ุงูุทุงุจูุฑ
3. ุงูููุงู ุงููุฌุฏููุฉ ุชุถูู ููุงู ุฅูู ุงูุทุงุจูุฑุ ูุฐูู ุชุญุชุงุฌ ูููููุง
4. ุงุณุชุฎุฏู Supervisor ุฃู NSSM ูู Production ูุฅุฏุงุฑุฉ ุงูุนูููุงุช ุชููุงุฆูุงู

























